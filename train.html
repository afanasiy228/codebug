<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>CodeBug ‚Äî –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</title>

    <style>
         :root {
            --bg: #0f0f11;
            --bg-card: #141417;
            --bg-soft: #1b1b20;
            --border: #262631;
            --border-light: #3a3a44;
            --text-main: #f5f5f7;
            --text-muted: #a3a3b8;
            --accent: #ffd451;
        }
        
        body {
            margin: 0;
            background: var(--bg);
            font-family: Inter, sans-serif;
            color: var(--text-main);
        }
        
        header {
            background: #0d0d0f;
            border-bottom: 1px solid var(--border);
            padding: 12px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 20px;
            font-weight: 800;
            color: var(--accent);
        }
        
        nav a {
            color: var(--text-muted);
            margin-left: 25px;
            text-decoration: none;
            font-size: 14px;
        }
        
        nav a:hover {
            color: var(--accent);
        }
        
        .page {
            max-width: 1300px;
            margin: 40px auto;
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 40px;
            padding: 0 30px;
        }
        /* SIDEBAR */
        
        .filters {
            background: var(--bg-card);
            border: 1px solid var(--border);
            padding: 20px;
            border-radius: 12px;
        }
        
        .filters h2 {
            margin: 0;
            color: var(--accent);
            font-size: 21px;
        }
        
        label {
            display: block;
            color: var(--text-muted);
            margin-top: 18px;
            margin-bottom: 6px;
            font-size: 14px;
        }
        /* SELECT */
        
        .select {
            position: relative;
        }
        
        .select select {
            width: 100%;
            padding: 10px;
            padding-right: 40px;
            background: #0f0f13;
            border: 1px solid var(--border-light);
            border-radius: 10px;
            color: var(--text-main);
            appearance: none;
            cursor: pointer;
        }
        
        .select::after {
            content: "‚ñæ";
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--accent);
            pointer-events: none;
        }
        
        .select select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(255, 212, 81, 0.25);
        }
        /* SEARCH */
        
        input[type="text"] {
            width: 100%;
            padding: 10px;
            background: #0f0f13;
            border: 1px solid var(--border-light);
            border-radius: 10px;
            color: var(--text-main);
            font-size: 14px;
            box-sizing: border-box;
        }
        
        input[type="text"]:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(255, 212, 81, 0.25);
        }
        /* MAIN */
        
        h1 {
            color: var(--accent);
            font-size: 30px;
            margin-top: 0;
        }
        
        .subtitle {
            color: var(--text-muted);
            margin-bottom: 20px;
        }
        
        .top-row {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .daily-card {
            background: var(--bg-card);
            border-radius: 12px;
            border: 1px solid var(--accent);
            padding: 16px 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 16px;
        }
        
        .daily-main {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .daily-caption {
            font-size: 14px;
            color: var(--accent);
        }
        
        .daily-title {
            font-size: 18px;
            font-weight: 600;
        }
        
        .btn-small {
            background: var(--accent);
            border-radius: 10px;
            border: none;
            padding: 8px 16px;
            font-weight: 700;
            cursor: pointer;
            color: #111;
            font-size: 14px;
            white-space: nowrap;
        }
        
        .btn-small:hover {
            filter: brightness(1.05);
        }
        
        .random-row {
            display: flex;
            justify-content: flex-start;
        }
        
        .btn-random {
            background: var(--accent);
            border: none;
            padding: 8px 16px;
            border-radius: 10px;
            color: #111;
            font-weight: 700;
            cursor: pointer;
            font-size: 14px;
        }
        
        .btn-random:hover {
            filter: brightness(1.05);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
        }
        
        th {
            background: var(--bg-soft);
            padding: 14px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        
        td {
            padding: 14px;
            border-bottom: 1px solid var(--border);
            font-size: 14px;
        }
        
        tr:hover {
            background: #1a1a21;
        }
        /* PILL TAGS */
        
        .pill {
            padding: 3px 8px;
            border-radius: 999px;
            border: 1px solid var(--border);
            font-size: 12px;
            background: #232327;
        }
        
        .link {
            color: var(--accent);
            text-decoration: none;
        }
        
        .link:hover {
            text-decoration: underline;
        }
        
        .empty {
            padding: 30px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            text-align: center;
            margin-top: 20px;
            color: var(--text-muted);
        }
    </style>
</head>

<body>

    <header>
        <div class="logo">CodeBug</div>
        <nav id="nav-links"></nav>
    </header>

    <div class="page">

        <!-- SIDEBAR -->
        <div class="filters">
            <h2>–§–∏–ª—å—Ç—Ä—ã</h2>

            <label>–°–ª–æ–∂–Ω–æ—Å—Ç—å</label>
            <div class="select">
                <select id="difficulty">
                <option value="">–õ—é–±–∞—è</option>
                <option value="easy">–õ—ë–≥–∫–∞—è</option>
                <option value="medium">–°—Ä–µ–¥–Ω—è—è</option>
                <option value="hard">–°–ª–æ–∂–Ω–∞—è</option>
            </select>
            </div>

            <label>–¢–∏–ø –æ—à–∏–±–∫–∏</label>
            <div class="select">
                <select id="errorType">
                <option value="">–õ—é–±–∞—è</option>
                <option value="–ê–ª–≥–æ—Ä–∏—Ç–º–∏—á–µ—Å–∫–∞—è">–ê–ª–≥–æ—Ä–∏—Ç–º–∏—á–µ—Å–∫–∞—è</option>
                <option value="–ü–∞–º—è—Ç—å">–ü–∞–º—è—Ç—å</option>
                <option value="–í—Ä–µ–º—è">–í—Ä–µ–º—è</option>
                <option value="–§–æ—Ä–º—É–ª—ã">–§–æ—Ä–º—É–ª—ã</option>
            </select>
            </div>

            <label>–ü–æ–∏—Å–∫</label>
            <input type="text" id="search" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: SuperMemo, DFS, —Ñ–æ—Ä–º—É–ª–∞‚Ä¶">
        </div>

        <!-- MAIN -->
        <main>
            <h1>–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</h1>
            <div class="subtitle">–ü–æ–¥–±–µ—Ä–∏—Ç–µ –∑–∞–¥–∞—á—É –ø–æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏–ª–∏ —Ç–∏–ø—É –æ—à–∏–±–∫–∏, –≤—ã–±–µ—Ä–∏—Ç–µ –∑–∞–¥–∞—á—É –¥–Ω—è –∏–ª–∏ –≤–æ–∑—å–º–∏—Ç–µ —Ä–∞–Ω–¥–æ–º.</div>

            <div class="top-row">
                <!-- –ó–∞–¥–∞—á–∞ –¥–Ω—è -->
                <div class="daily-card" id="daily-card">
                    <div class="daily-main">
                        <div class="daily-caption">üî• –ó–∞–¥–∞—á–∞ –¥–Ω—è</div>
                        <div class="daily-title" id="daily-title">–ó–∞–≥—Ä—É–∂–∞—é‚Ä¶</div>
                    </div>
                    <button class="btn-small" onclick="openDaily()">–û—Ç–∫—Ä—ã—Ç—å</button>
                </div>

                <!-- –†–∞–Ω–¥–æ–º–Ω–∞—è –∑–∞–¥–∞—á–∞ -->
                <div class="random-row">
                    <button class="btn-random" onclick="openRandom()">üé≤ –°–ª—É—á–∞–π–Ω–∞—è –∑–∞–¥–∞—á–∞</button>
                </div>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                        <th>–°–ª–æ–∂–Ω–æ—Å—Ç—å</th>
                        <th>–¢–∏–ø –æ—à–∏–±–∫–∏</th>
                    </tr>
                </thead>
                <tbody id="tbody"></tbody>
            </table>

            <div id="empty" class="empty" style="display:none;">–ó–∞–¥–∞—á–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã‚Ä¶</div>
        </main>

    </div>

    <script src="auth.js"></script>

    <script>
        // ============================
        // –ó–ê–ì–†–£–ó–ö–ê –ó–ê–î–ê–ß –ò–ó tasks/<id>/meta.json
        // ============================

        async function loadProblems() {
            console.log("[training] loadProblems() start");
            const list = [];
            let id = 0;

            while (true) {
                const url = `tasks/${id}/meta.json`;
                console.log("[training] –ø—Ä–æ–±—É—é", url);

                try {
                    const res = await fetch(url);
                    if (!res.ok) {
                        console.log("[training] fetch not ok, break at id =", id, "status =", res.status);
                        break;
                    }

                    const meta = await res.json();
                    console.log("[training] meta loaded:", meta);

                    list.push({
                        id: typeof meta.id === "number" ? meta.id : id,
                        title: meta.title || ("–ó–∞–¥–∞—á–∞ " + id),
                        difficulty: meta.difficulty || "",
                        type: meta.type || "",
                        tags: meta.tags || []
                    });
                } catch (e) {
                    console.log("[training] fetch/meta error at id =", id, e);
                    break;
                }

                id++;
            }

            console.log("[training] total problems loaded:", list.length);
            return list;
        }

        let problems = [];
        let dailyProblem = null;

        async function initTraining() {
            console.log("[training] initTraining()");

            problems = await loadProblems();

            if (problems.length === 0) {
                document.getElementById("daily-title").innerText = "–ó–∞–¥–∞—á–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã";
                document.getElementById("daily-card").style.opacity = "0.6";
            } else {
                // –∑–∞–¥–∞—á–∞ –¥–Ω—è ‚Äî –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ –ø–æ –¥–∞—Ç–µ
                const today = new Date();
                const seed = today.getFullYear() * 10000 + (today.getMonth() + 1) * 100 + today.getDate();
                const idx = seed % problems.length;
                dailyProblem = problems[idx];

                document.getElementById("daily-title").innerText = dailyProblem.title;
            }

            renderTable();
        }

        // ============================
        // –†–ï–ù–î–ï–† –¢–ê–ë–õ–ò–¶–´
        // ============================

        function diffPill(diff) {
            const map = {
                easy: "background:#2c7a3f; color:#d6ffd6;",
                medium: "background:#b59b34; color:#fff8d1;",
                hard: "background:#8b2c2c; color:#ffd6d6;"
            };
            let text = diff;
            if (diff === "easy") text = "–õ—ë–≥–∫–∞—è";
            else if (diff === "medium") text = "–°—Ä–µ–¥–Ω—è—è";
            else if (diff === "hard") text = "–°–ª–æ–∂–Ω–∞—è";

            return `<span class="pill" style="${map[diff] || ""}">${text || "-"}</span>`;
        }

        function typePill(type) {
            if (!type) return `<span class="pill">‚Äî</span>`;
            return `<span class="pill" style="background:#264d7a; color:#d9ecff;">${type}</span>`;
        }

        function renderTable() {
            console.log("[training] renderTable()");

            const diff = document.getElementById("difficulty").value;
            const err = document.getElementById("errorType").value;
            const query = document.getElementById("search").value.toLowerCase();

            const filtered = problems.filter(p =>
                (!diff || p.difficulty === diff) &&
                (!err || p.type === err) &&
                (!query || p.title.toLowerCase().includes(query))
            );

            const tbody = document.getElementById("tbody");
            const empty = document.getElementById("empty");

            tbody.innerHTML = "";
            empty.style.display = filtered.length ? "none" : "block";

            filtered.forEach(p => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                <td>${p.id}</td>
                <td><a class="link" href="problem.html?id=${p.id}">${p.title}</a></td>
                <td>${diffPill(p.difficulty)}</td>
                <td>${typePill(p.type)}</td>
            `;
                tbody.appendChild(tr);
            });
        }

        // ============================
        // –ö–ù–û–ü–ö–ò: –ó–ê–î–ê–ß–ê –î–ù–Ø –ò –†–ê–ù–î–û–ú
        // ============================

        function openDaily() {
            console.log("[training] openDaily()");
            if (!dailyProblem) {
                alert("–ó–∞–¥–∞—á–∞ –¥–Ω—è –ø–æ–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞");
                return;
            }
            window.location.href = "problem.html?id=" + dailyProblem.id;
        }

        function openRandom() {
            console.log("[training] openRandom()");
            if (!problems.length) {
                alert("–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∑–∞–¥–∞—á");
                return;
            }
            const idx = Math.floor(Math.random() * problems.length);
            const p = problems[idx];
            window.location.href = "problem.html?id=" + p.id;
        }

        // ============================
        // –°–û–ë–´–¢–ò–Ø
        // ============================

        document.addEventListener("DOMContentLoaded", () => {
            console.log("[training] DOMContentLoaded");
            // navbar
            if (typeof updateNavbar === "function") {
                updateNavbar();
            } else {
                console.warn("[training] updateNavbar() –Ω–µ –Ω–∞–π–¥–µ–Ω");
            }

            // —Ñ–∏–ª—å—Ç—Ä—ã
            document.getElementById("difficulty").addEventListener("change", renderTable);
            document.getElementById("errorType").addEventListener("change", renderTable);
            document.getElementById("search").addEventListener("input", renderTable);

            // –∑–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á
            initTraining();
        });
    </script>

</body>

</html>