1) Разбейте дерево на тяжёлые пути (HLD).
2) Каждому узлу сопоставьте позицию в базовом массиве.
3) Храните сегментное дерево по базовому массиву для суммы и обновлений.
4) Запрос на путь разбивается на O(log n) отрезков.
