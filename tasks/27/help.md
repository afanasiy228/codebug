Используйте DSU (система непересекающихся множеств).
