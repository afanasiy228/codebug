Сегментное дерево решает задачу за O(log n).
