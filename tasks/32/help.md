Используйте Z-функцию за O(n).
