1) Используйте центроидную декомпозицию дерева.
2) Для каждого центроида храните структуры по расстояниям до красных вершин.
3) Обновление и запрос выполняются за O(log^2 n).
