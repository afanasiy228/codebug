1) Отсортируйте массив.
2) Посчитайте префиксные суммы по отсортированным значениям.
3) Для диапазона найдите индексы через lower_bound/upper_bound.
