1) Используйте алгоритм Манакера.
2) Он позволяет найти радиусы всех палиндромов за O(n).
3) Сумма радиусов даёт количество подстрок.
