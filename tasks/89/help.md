1) Сожмите координаты, чтобы значения лежали в диапазоне 1..n.
2) Используйте дерево Фенвика для подсчета элементов справа.
3) Суммируйте количество меньших элементов для каждого значения.
