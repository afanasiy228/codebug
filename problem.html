<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>CodeBug ‚Äî –ó–∞–¥–∞—á–∞</title>

    <style>
         :root {
            --bg: #0f0f11;
            --bg2: #141417;
            --bg3: #1b1b20;
            --border: #262631;
            --text: #f5f5f7;
            --text2: #b5b5c0;
            --accent: #ffd451;
        }
        
        body {
            margin: 0;
            background: var(--bg);
            color: var(--text);
            font-family: Inter, sans-serif;
            overflow: hidden;
        }
        /* HEADER */
        
        header {
            padding: 12px 30px;
            background: #0d0d0f;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 20px;
            font-weight: 800;
            color: var(--accent);
        }
        
        nav a {
            margin-left: 20px;
            color: var(--text2);
            text-decoration: none;
        }
        
        nav a:hover {
            color: var(--accent);
        }
        /* LAYOUT */
        
        table td,
        table th {
            text-align: center;
        }
        
        table {
            margin-left: auto;
            margin-right: auto;
        }
        
        .split-v {
            display: flex;
            height: calc(100vh - 58px);
            width: 100%;
            overflow: hidden;
        }
        
        .io-block {
            background: #0f0f12;
            border: 1px solid var(--border);
            padding: 10px;
            border-radius: 8px;
            white-space: pre-wrap;
            font-family: monospace;
            margin-top: 4px;
        }
        
        .left {
            width: 40%;
            min-width: 260px;
            max-width: 70%;
            padding: 20px;
            background: var(--bg2);
            border-right: 1px solid var(--border);
            overflow-y: auto;
            flex-shrink: 0;
        }
        
        .splitter-v {
            width: 6px;
            cursor: col-resize;
            background: #2d2d33;
            flex-shrink: 0;
        }
        
        .splitter-v:hover {
            background: var(--accent);
        }
        
        .right {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--bg3);
            overflow: hidden;
        }
        
        #editorArea {
            flex: 1;
            overflow: hidden;
        }
        
        #editor {
            height: 100%;
            width: 100%;
        }
        
        .splitter-h {
            height: 6px;
            cursor: row-resize;
            background: #2d2d33;
        }
        
        .splitter-h:hover {
            background: var(--accent);
        }
        /* SUBMISSIONS PANEL */
        
        #testsPanel {
            height: 240px;
            min-height: 120px;
            background: var(--bg2);
            border-top: 1px solid var(--border);
            padding: 15px;
            overflow-y: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            color: var(--text);
        }
        
        th,
        td {
            border-bottom: 1px solid var(--border);
            padding: 8px;
            font-size: 14px;
        }
        
        th {
            color: var(--accent);
        }
        
        .ctrl {
            display: flex;
            gap: 12px;
            padding: 10px;
            background: #0d0d0f;
            border-top: 1px solid var(--border);
        }
        
        #taskStatement {
            font-size: 16.5px;
            line-height: 1.45;
        }
        
        .btn {
            padding: 8px 16px;
            background: var(--accent);
            border: none;
            border-radius: 6px;
            font-weight: 700;
            cursor: pointer;
            color: black;
        }
        
        .btn:hover {
            background: #ffe17e;
        }
        
        .testcase {
            margin-bottom: 12px;
            background: #0f0f12;
            padding: 10px;
            border-radius: 10px;
            border: 1px solid var(--border);
            white-space: pre-wrap;
        }
        
        .kf-block {
            margin-top: 20px;
        }
        
        .kf-title {
            font-weight: 700;
            margin-bottom: 6px;
            font-size: 16px;
            color: var(--accent);
        }
        
        .kf-io {
            background: #0f0f11;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 0;
            margin-bottom: 22px;
            position: relative;
        }
        
        .kf-copy {
            position: absolute;
            right: 10px;
            top: 10px;
            background: #1f1f22;
            border: 1px solid var(--border);
            padding: 4px 10px;
            font-size: 12px;
            border-radius: 6px;
            cursor: pointer;
            color: var(--text);
        }
        
        .kf-copy:hover {
            background: #2a2a2e;
        }
        
        .kf-pre {
            white-space: pre-wrap;
            padding: 16px;
            margin: 0;
            font-family: monospace;
            font-size: 15px;
            line-height: 1.35;
            color: var(--text);
        }
        
        .kf-pre {
            font-size: 13.5px;
            padding: 10px;
            line-height: 1.25;
        }
        
        .testcase-block {
            margin-bottom: 70px;
            /* —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω –º–∞–ª–µ–Ω—å–∫–∏–π –æ—Ç—Å—Ç—É–ø */
        }
    </style>
</head>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script src="firebase.js"></script>
<!-- –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–≤–æ–π! -->
<script src="auth.js"></script>
<!-- –∏—Å–ø–æ–ª—å–∑—É–µ—Ç db -->
<script src="globalsubmissions.js"></script>
<!-- –∏—Å–ø–æ–ª—å–∑—É–µ—Ç db -->
<script src="submit.js"></script>

<script>
    console.log("AFTER LOADING FIREBASE:", typeof firebase);
</script>

<!-- =========================================== -->

<body>

    <header>
        <div class="logo">CodeBug</div>
        <nav id="nav-links"></nav>
    </header>

    <div class="split-v">

        <!-- LEFT -->
        <div class="left" id="leftPanel">
            <h1 id="taskTitle">...</h1>
            <div id="taskStatement">–ó–∞–≥—Ä—É–∂–∞—é —É—Å–ª–æ–≤–∏–µ‚Ä¶</div>

            <h2 style="color:var(--accent); margin-top:25px;">–ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤</h2>
            <div id="examples"></div>
        </div>

        <div class="splitter-v" id="vSplit"></div>

        <!-- RIGHT -->
        <div class="right">
            <div id="editorArea">
                <!-- –æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä -->
                <textarea id="editor" style="height:100%; width:100%; background:#1e1e1e; color:#f5f5f7;
                             border:none; resize:none; padding:10px; box-sizing:border-box;
                             font-family:monospace; font-size:14px;"></textarea>

            </div>

            <script>
                window.editor = {
                    getValue: function() {
                        var el = document.getElementById("editor");
                        if (!el) return "";
                        return el.value;
                    },

                    setValue: function(text) {
                        var el = document.getElementById("editor");
                        if (!el) return;
                        if (text === undefined || text === null) {
                            el.value = "";
                        } else {
                            el.value = text;
                        }
                    }
                };

                console.log("[editor] textarea mode enabled");
            </script>

            <div class="splitter-h" id="hSplit"></div>

            <div id="testsPanel">
                <h3 style="margin:0 0 10px; color:var(--accent);">–ü–æ—Å—ã–ª–∫–∏</h3>

                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–í—Ä–µ–º—è</th>
                        </tr>
                    </thead>
                    <tbody id="subs">
                        <tr>
                            <td colspan="4" style="color:var(--text2);text-align:center;">–ü–æ–∫–∞ –Ω–µ—Ç –ø–æ—Å—ã–ª–æ–∫</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="ctrl">
                <button class="btn" onclick="testFirebaseWrite()">TEST SUBMIT</button>
                <button class="btn" onclick="submitCode()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </div>
        </div>
    </div>


    <!-- ===================== GLOBAL SUBMISSIONS ===================== -->
    <script>
        function addSubmissionToTable(idx, sub) {
            const body = document.getElementById("subs");
            const tr = document.createElement("tr");

            const color = sub.status === "OK" ? "#4f4" : "#f55";
            const date = new Date(sub.date).toLocaleTimeString();

            tr.innerHTML = `
        <td>${idx}</td>
        <td style="color:${color}; font-weight:600;">${sub.status}</td>
        <td>${date}</td>
        <td>‚Äî</td>
    `;

            body.appendChild(tr);
        }
    </script>
    <script>
        async function saveGlobalSubmission(user, problem, verdict) {
            const entry = {
                user: String(user),
                problem: String(problem),
                status: String(verdict),
                date: Date.now()
            };

            await firebase.database().ref("submissions").push().set(entry);

            console.log("üî• –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–æ—Å—ã–ª–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞:", entry);
        }
    </script>

    <!-- ===================== SUBMIT CODE ===================== -->
    <script>
        console.log("%c[profile submit.js] –∑–∞–≥—Ä—É–∂–µ–Ω", "color:#0f0; font-weight:bold;");

        /* ============================================================
           SETTINGS
           ============================================================ */

        const SUBMIT_URL = "https://f096ef8cdee8.ngrok-free.app/submit";

        if (!window.firebase) {
            console.error("üî• Firebase –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω!");
        }

        /* ============================================================
           SUBMIT CODE (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è)
           ============================================================ */

        async function submitCode() {
            console.log("[submitCode] —Å—Ç–∞—Ä—Ç");

            const url = new URL(window.location.href);
            const taskId = url.searchParams.get("id");

            console.log("taskId =", taskId);

            if (!taskId) {
                alert("–ù–µ—Ç ID –∑–∞–¥–∞—á–∏");
                return;
            }

            const user = getUser();

            if (!user) {
                alert("–∑–∞—Ä–µ–≥—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å —á—Ç–æ–±—ã —Ä–µ—à–∞—Ç—å –∑–∞–¥–∞—á–∏");
                return;
            }

            const code = editor.getValue();
            console.log("code =", code.substring(0, 100), "...");
            try {
                const verdict = await sendToJudge(taskId, code);
                console.log("‚¨Ö –í–µ—Ä–¥–∏–∫—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:", verdict);

                await saveSubmission(user, taskId, verdict.status);
                alert("–í–µ—Ä–¥–∏–∫—Ç: " + verdict.status);
                if (verdict.status == "OK") submitOK(user, taskID);
                console.log("üíæ Firebase —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ OK");

            } catch (e) {
                console.error("üî• –û—à–∏–±–∫–∞ submitCode:", e);
            }
        }

        /* ============================================================
           SEND TO JUDGE
           ============================================================ */

        async function sendToJudge(taskId, code) {
            console.log("%c[sendToJudge()] ‚Üí fetch()", "color:#aaf");

            const payload = {
                task: taskId,
                code: code
            };

            console.log("Payload JSON:", payload);

            let res;
            try {
                res = await fetch(SUBMIT_URL, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    mode: "cors",
                    body: JSON.stringify(payload)
                });
            } catch (e) {
                console.error("‚ùå –û—à–∏–±–∫–∞ fetch:", e);
                throw new Error("–°–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç");
            }

            console.log("–û—Ç–≤–µ—Ç RAW:", res);

            if (!res.ok) {
                console.error("‚ùå HTTP –æ—à–∏–±–∫–∞:", res.status);
                throw new Error("HTTP " + res.status);
            }

            let data;
            try {
                data = await res.json();
            } catch (e) {
                console.error("‚ùå –û—à–∏–±–∫–∞ JSON:", e);
                throw new Error("–ù–µ–≤–∞–ª–∏–¥–Ω—ã–π JSON");
            }

            console.log("üì¶ JSON:", data);
            return data;
        }

        async function saveSubmission(login, taskId, verdict) {
            console.log("%c[saveSubmission()] ‚Üí GLOBAL ONLY", "color:#fa0;");

            const db = firebase.database();

            const globalRef = db.ref("submissions/global");

            const record = {
                login,
                task: Number(taskId),
                verdict,
                date: Date.now()
            };

            console.log("–ì–ª–æ–±–∞–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å:", record);

            try {
                await globalRef.push(record);
                console.log("‚úî global push OK");
            } catch (e) {
                console.error("üî• –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:", e);
                throw e;
            }
        }

        /* ============================================================
   LOAD USER SUBMISSIONS (–ø–æ—Å—ã–ª–∫–∏ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –∑–∞–¥–∞—á–µ)
   ============================================================ */

        async function loadMySubsForThisProblem() {
            console.log("%c[loadMySubsForThisProblem()]", "color:#0af;");

            const user = getUser();
            if (!user) {
                console.warn("‚ö† –ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Äî —Ç–∞–±–ª–∏—Ü—É –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ–º");
                return;
            }

            const url = new URL(location.href);
            const taskId = Number(url.searchParams.get("id"));

            const tbody = document.getElementById("subs");
            if (!tbody) {
                console.error("‚ùå tbody #subs –Ω–µ –Ω–∞–π–¥–µ–Ω!");
                return;
            }

            tbody.innerHTML = "<tr><td colspan='3' style='color:#999'>–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</td></tr>";

            const snap = await firebase.database()
                .ref("submissions/global")
                .get();

            if (!snap.exists()) {
                tbody.innerHTML = "<tr><td colspan='3'>–ü–æ–∫–∞ –Ω–µ—Ç –ø–æ—Å—ã–ª–æ–∫‚Ä¶</td></tr>";
                return;
            }

            const all = Object.values(snap.val());

            const mine = all
                .filter(s => s.login === user && Number(s.task) === Number(taskId))
                .sort((a, b) => b.date - a.date);

            if (mine.length === 0) {
                tbody.innerHTML = "<tr><td colspan='3'>–ü–æ–∫–∞ –Ω–µ—Ç –ø–æ—Å—ã–ª–æ–∫‚Ä¶</td></tr>";
                return;
            }

            tbody.innerHTML = "";
            let i = mine.length;

            for (let s of mine) {
                const verdictColor =
                    s.verdict === "OK" ? "#7fff7f" :
                    s.verdict === "WA" ? "#ff7777" :
                    s.verdict === "RE" ? "#ffb37c" :
                    "#ffd451";

                tbody.innerHTML += `
        <tr>
            <td>${i--}</td>
            <td style="color:${verdictColor}; font-weight:600;">
                ${s.verdict}
            </td>
            <td>${new Date(s.date).toLocaleTimeString()}</td>
        </tr>`;
            }
        }


        async function submitOK(user, taskId) {
            console.log("%c[submitOK()] ‚Üí updating user stats", "color:#0f0; font-weight:bold;");

            if (!user) {
                console.error("‚ùå submitOK: no user");
                return;
            }

            const ref = firebase.database().ref("users/" + user + "/stats");

            try {
                const snap = await ref.get();
                let data = snap.val();


                taskId = String(taskId);

                // –ï—Å–ª–∏ —É–∂–µ —Ä–µ—à–∞–ª ‚Äî –≤—ã—Ö–æ–¥–∏–º
                if (data.solved[taskId] === true) {
                    console.log("‚úì submitOK: –∑–∞–¥–∞—á–∞ —É–∂–µ –æ—Ç–º–µ—á–µ–Ω–∞ –∫–∞–∫ —Ä–µ—à—ë–Ω–Ω–∞—è");
                    return;
                }

                // –û—Ç–º–µ—á–∞–µ–º –∫–∞–∫ —Ä–µ—à—ë–Ω–Ω—É—é
                data.solved[taskId] = true;

                // –ê–ø–¥–µ–π—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                data.exp = (data.exp || 0) + 10;
                data.cnt = Object.values(data.solved).filter(x => x === true).length;

                await ref.set(data);

                console.log("üî• submitOK: –æ–±–Ω–æ–≤–ª–µ–Ω–æ:", data);

            } catch (e) {
                console.error("‚ùå submitOK error:", e);
            }
        }
    </script>



    <!-- ===================== COPY INPUT BUTTON ===================== -->
    <script>
        function copyKF(btn) {
            const pre = btn.parentElement.querySelector(".kf-pre");
            if (!pre) return;

            const text = pre.innerText;
            navigator.clipboard.writeText(text).then(() => {
                btn.innerText = "–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ";
                setTimeout(() => (btn.innerText = "–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å"), 8);
            });
        }
    </script>

    <!-- ===================== LOAD USER SUBMISSIONS ON START ===================== -->
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            updateNavbar();
            loadMySubsForThisProblem();
        });
    </script>

    <!-- ===================== VERTICAL + HORIZONTAL SPLITTERS ===================== -->
    <script>
        // –°–ª–∞–π–¥–µ—Ä—ã –æ—Å—Ç–∞–≤–ª–µ–Ω—ã –∫–∞–∫ –±—ã–ª–∏

        let vSplit = document.getElementById("vSplit");
        let left = document.getElementById("leftPanel");
        let isV = false;

        vSplit.addEventListener("mousedown", () => isV = true);
        document.addEventListener("mouseup", () => {
            isV = false;
            isH = false;
        });

        document.addEventListener("mousemove", e => {
            let needUpdate = false;

            if (isV) {
                let w = e.clientX;
                if (w < 200) w = 200;
                if (w > window.innerWidth * 0.7) w = window.innerWidth * 0.7;
                left.style.width = w + "px";
                needUpdate = true;
            }

            if (isH) {
                let newHeight = window.innerHeight - e.clientY - 70;
                if (newHeight < 120) newHeight = 120;
                if (newHeight > window.innerHeight * 0.7) newHeight = window.innerHeight * 0.7;
                testsPanel.style.height = newHeight + "px";
                needUpdate = true;
            }

            if (needUpdate) {
                const editorContainer = document.getElementById("editor");
                editorContainer.style.height =
                    (window.innerHeight - testsPanel.offsetHeight - 90) + "px";

                // Monaco-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–µ —É–±—Ä–∞–ª–∏: –∑–¥–µ—Å—å –±–æ–ª—å—à–µ –Ω–∏—á–µ–≥–æ –Ω–µ –≤—ã–∑—ã–≤–∞–µ–º
            }
        });

        let isH = false;
        const hSplit = document.getElementById("hSplit");
        const testsPanel = document.getElementById("testsPanel");
        hSplit.onmousedown = () => isH = true;
    </script>

    <!-- ===================== LOAD TASK (meta + tests) ===================== -->
    <script>
        async function loadTask() {

            const url = new URL(location.href);
            const id = url.searchParams.get("id") || "0";


            // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî META.JSON ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
            const metaPath = `tasks/${id}/meta.json`;

            try {
                const res = await fetch(metaPath);

                const meta = await res.json();

                document.getElementById("taskTitle").innerText = meta.title || "–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è";
            } catch (e) {
                document.getElementById("taskTitle").innerText = "–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ";
            }

            // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî STATEMENT.MD ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
            const stmtPath = `tasks/${id}/statement.md`;

            try {
                const res = await fetch(stmtPath);

                const md = await res.text();

                document.getElementById("taskStatement").innerHTML = md.replace(/\n/g, "<br>");
            } catch (e) {
                document.getElementById("taskStatement").innerText = "statement.md –Ω–µ –Ω–∞–π–¥–µ–Ω";
            }

            // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî CODE.CPP ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
            const codePath = `tasks/${id}/code.cpp`;

            try {
                const res = await fetch(codePath);

                const code = await res.text();

                if (window.editor) {
                    editor.setValue(code);
                } else {}
            } catch (e) {

                if (window.editor) editor.setValue("// code.cpp –Ω–µ –Ω–∞–π–¥–µ–Ω");
            }

            // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî PRIMITIVES TESTS ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
            const examples = document.getElementById("examples");

            for (let i = 1; i <= 2; i++) {
                console.log(`üìÑ test ${i}`);

                const inPath = `tasks/${id}/tests/${i}.in`;
                const outPath = `tasks/${id}/tests/${i}.out`;

                try {
                    const inpRes = await fetch(inPath);

                    const inp = await inpRes.text();

                    const outRes = await fetch(outPath);

                    const out = await outRes.text();


                    examples.innerHTML += `
                <div class="testcase-block">
                    <div class="kf-title">–¢–µ—Å—Ç ${i}</div>

                    <div class="kf-io">
                        <div class="kf-copy" onclick="copyKF(this)">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</div>
                        <pre class="kf-pre">${inp.trim()}</pre>
                    </div>

                    <div class="kf-title" style="margin-top:10px;">–í—ã–≤–æ–¥</div>
                    <div class="kf-io">
                        <div class="kf-copy" onclick="copyKF(this)">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</div>
                        <pre class="kf-pre">${out.trim()}</pre>
                    </div>
                </div>
            `;
                } catch (e) {
                    console.error(`‚ùå test ${i} ERROR:`, e);
                }
            }

        }
    </script>

    <script>
        console.log("FIREBASE TEST:", typeof firebase);
    </script>

    <script>
        async function testFirebaseWrite() {
            console.log("%c[testFirebaseWrite()] start", "color:#0f0");

            // login –±–µ—Ä—ë–º –∏–∑ auth.js
            const user = getUser() || "anonymous";

            const entry = {
                user: user,
                message: "TEST WRITE OK",
                time: Date.now()
            };

            try {
                // ‚ö†Ô∏è Firebase —É–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –≤ firebase.js ‚Äî –∑–¥–µ—Å—å –ù–ï —Ç—Ä–æ–≥–∞–µ–º!
                await firebase.database()
                    .ref("submissions_test")
                    .push()
                    .set(entry);

                console.log("üî• Firebase TEST ENTRY ADDED:", entry);
            } catch (e) {
                console.error("‚ùå Firebase write error:", e);
            }
        }
    </script>

    <!-- ===================== SIMPLE TEXT EDITOR –≤–º–µ—Å—Ç–æ Monaco ===================== -->
    <script>
        let editor = {
            setValue() {},
            getValue() {
                return "";
            }
        };

        function initializeTextEditor() {
            const el = document.getElementById("editor");
            if (!el) {
                console.error("editor element not found");
                return;
            }

            editor = {
                setValue(text) {
                    el.value = text ? text : "";
                },
                getValue() {
                    return el.value;
                }
            };

            // –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
            el.value = "// –ó–∞–≥—Ä—É–∂–∞—é code.cpp...";
        }

        document.addEventListener("DOMContentLoaded", () => {
            // —Ä–µ–¥–∞–∫—Ç–æ—Ä –∏ –∑–∞–¥–∞—á–∞
            initializeTextEditor();
            loadTask();
        });
    </script>

</body>

</html>